{% extends "base.html" %}
{% block content %}

<h2>ë‚´ í”„ë¡œí•„</h2>
<hr>

<h3>ğŸ™‹ ë‚´ ì •ë³´</h3>

<form method="post" action="/me/username" style="margin-bottom:10px;">
  <label>
    ë‹‰ë„¤ì„
    <input type="text" name="username" value="{{ user.username }}" required>
  </label>
  <button type="submit">ì €ì¥</button>
</form>

<p>ì´ë©”ì¼: <b>{{ user.email }}</b></p>

<hr>

<h3>ğŸ“ ë‚´ ë™ë„¤</h3>

{% if nid %}
  <p>
    í˜„ì¬ ë™ë„¤:
    <b>
      {{ (neighborhoods | selectattr("id", "equalto", nid) | list | first).name }}
    </b>
  </p>

  {% if neighborhood_rel %}
    <p>
      ì¸ì¦ ìƒíƒœ:
      <b>{{ neighborhood_rel.verify_status }}</b>
    </p>
  {% endif %}

  <button type="button" onclick="openModal()">ë™ë„¤ ë³€ê²½</button>
{% else %}
  <p>ì•„ì§ ë™ë„¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ì–´.</p>
  <button type="button" onclick="openModal()">ë™ë„¤ ì„¤ì •</button>
{% endif %}

<!-- ëª¨ë‹¬ -->
<div id="neighModal" class="modal-backdrop" style="display:none;">
  <div class="modal">
    <h3>ë™ë„¤ ì„ íƒ</h3>

    <form method="post" action="/choose-neighborhood?next=/me">
      <div style="margin: 10px 0;">
        <select name="neighborhood_id" required style="width: 100%; padding: 6px;">
          <option value="" disabled {% if not nid %}selected{% endif %}>ë™ë„¤ë¥¼ ì„ íƒí•´ì¤˜</option>
          {% for n in neighborhoods %}
            <option value="{{ n.id }}" {% if nid == n.id %}selected{% endif %}>{{ n.name }}</option>
          {% endfor %}
        </select>
      </div>

      <div style="display:flex; gap:8px; justify-content:flex-end;">
        <button type="button" onclick="closeModal()">ì·¨ì†Œ</button>
        <button type="submit">ì €ì¥</button>
      </div>
    </form>
  </div>
</div>

<hr>

<h3>ğŸ“ ë‚´ í™œë™</h3>
<ul>
  <li><a href="/me/posts">ë‚´ê°€ ì“´ ëª¨ì§‘ê¸€</a></li>
  <li><a href="/me/joins">ë‚´ê°€ ì°¸ì—¬í•œ ëª¨ì§‘ê¸€</a></li>
</ul>

<hr>

<h3>âš¡ ë¹ ë¥¸ ì•¡ì…˜</h3>
<p><a href="/posts/new">+ ëª¨ì§‘ê¸€ ì‘ì„±</a></p>

<style>
  .modal-backdrop{
    position: fixed; inset: 0;
    background: rgba(0,0,0,.35);
    display: flex; align-items: center; justify-content: center;
    padding: 20px;
  }
  .modal{
    width: 100%;
    max-width: 420px;
    background: white;
    border-radius: 10px;
    padding: 16px 16px 14px;
    box-shadow: 0 10px 30px rgba(0,0,0,.25);
  }
</style>

<script>
  function openModal(){
    document.getElementById("neighModal").style.display = "flex";
  }
  function closeModal(){
    document.getElementById("neighModal").style.display = "none";
  }
  // ë°”ê¹¥ í´ë¦­í•˜ë©´ ë‹«ê¸°
  document.getElementById("neighModal").addEventListener("click", function(e){
    if(e.target === this) closeModal();
  });
</script>

{% endblock %}
